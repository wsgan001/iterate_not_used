
## 2 安装 CentOS

完成之前的知识积累和软件下载后，就可以开始安装CentOS 了。读者可能会遇到不同的环境，因此本节将模拟不同的环境，使用不同的方法安装CentOS。

### 2.1 创建虚拟机

在虚拟中单击菜单栏中的“文件”，在弹出的菜单中选择“新建虚拟机”，之后将弹出新建 虚拟机向导，如图2.3所示。


![mark](http://pacdb2bfr.bkt.clouddn.com/blog/image/180712/B1m1hdJkfH.png?imageslim)


首先需要选择采用什么类型新建虚拟机，如果使用自定义，向导将会要求用户选择虚拟机的兼容版本，SCSI控制器类型等，<span style="color:red;">什么是虚拟机的兼容版本？什么是SCSI？</span>此处选择“典型”，然后单击“下一步”。接下来向导会要求用户选择安装来源，如图2.4所示。

通常不建议大家在此处选择安装光盘，此处建议选中“稍后安装操作系统”，并单击“下一步”。接下来向导会提示用户选择操作系统类型，如图2.5所示。

![mark](http://pacdb2bfr.bkt.clouddn.com/blog/image/180712/2Chi6kbd02.png?imageslim)


此处选择“客户机操作系统"为“Linux”，然后在“版本”列表中选择“CentOS 64位” （截至本书编写时CentOS 7还没有发布32位版，因此此处选择64位版），然后单击“下一步”。 接下来向导会提示用户命名虚拟机，如图2.6所示。

在虚拟机名称中输入虚拟机名，然后单击位置后面的“浏览”按钮，选择虚拟机文件保存 的目录，最后单击“下一步”进入指定磁盘容量页面，如图2.7所示。

![mark](http://pacdb2bfr.bkt.clouddn.com/blog/image/180712/k76LIEm3e0.png?imageslim)

如果仅需要安装基本版的 CentOS7,磁盘空间 10GB 已经足够使用了；如果要存放其他文件则按文件大小调整硬盘空间大小。之后将选择虚拟磁盘存储为单个文件还是多个文件，这是由存放虚拟机文件的分区类型决定的。如果文件类型为FAT32，必须选择存储为多个文件， 这是因为 FAT32 不支持 4GB 以上的单个文件。<span style="color:red;">嗯。</span>用户可以在对应的盘符上单击右键选择“属性”，在弹出的常规页面中查看文件系统类型。选择好磁盘选项后，单击“下一步”就会弹出完成创建页面，如图2.8所示。

![mark](http://pacdb2bfr.bkt.clouddn.com/blog/image/180712/lheI83BKDE.png?imageslim)

在完成创建页面中，可以单击“自定义硬件”按钮弹出修改虚拟机的硬件设备页面。在自定义硬件设备页面中，需要检查内存容量应该大于 512MB ,否则 CentOS 将无法启动安装程序; 如果要使用U盘、移动硬盘等设备，硬件中必须包含USB控制器；安装时需要使用光盘，因此CD/DVD设备也必不可少。确认以上信息之后就可以单击“完成”按钮，完成虚拟机创建。

### 2.2 光盘安装 CentOS7

Linux的安装方法有很多种，本小节主要以光盘安装为例介绍 Linux 的安装过程及相关的参数设置。详细步骤如下：

**步骤1：** 打开创建的虚拟机，单击“编辑座拟机设置”，或在主窗体右侧库中找到新建的虚拟机右键单击，并在弹出的菜单中选择“设置”，调出虚拟机设置窗口，如图2.9所示。

![mark](http://pacdb2bfr.bkt.clouddn.com/blog/image/180712/7jAkej57l1.png?imageslim)

在虚拟机设置窗口中单击硬件选项中的 “CD/DVD (IDE)” ，然后在右侧选择 “使用物理驱动器” (即使用宿主机的光驱)或 “使用ISO映像文件”。读者可根据实际情况进行选择，此例中选择 “使用ISO映像文件” 并单击浏览选择下载的光盘文件，完成后单击“确定”保存设置即可。

**步骤2：** 通过以上步骤完成虚拟机的参数设置，下一步是启动虚拟机，单击“开启虚拟机” 选项或单击其中的绿色箭头即可启动虚拟机，如图2.10所示。

![mark](http://pacdb2bfr.bkt.clouddn.com/blog/image/180712/6HfmG4IAJ9.png?imageslim)

**步骤3：** 启动后耐心等待安装程序引导完毕，即进入Linux的安装界面。Linux的安装和 Windows 的安装类似，如图2.11所示。

![mark](http://pacdb2bfr.bkt.clouddn.com/blog/image/180712/h4fDiBAlhj.png?imageslim)

画面中给出 了三个选项，“Install CentOS 7”、“Test this media & install CentOS 7” 和 “Troubleshooting”。第一个选项表示直接安装 CentOS7，第二个选项表示先测试光盘有无错误然后再安装，第三个选项主要用来测试内存和启动救援模式修复已存在的CentOS。此示例中 选择第一项，直接安装 CentOS7，如果对安装光盘表示怀疑也可选择第二项。

选中第一项“Install CentOS 7”并按Enter键，等待数秒后会提示用户按Enter键启动安装 程序，此时可以按Enter键或等待数秒待系统自动启动安装程序。

**步骤4：** 安装程序启动后，首先会提示用户在安装过程中使用的语言，如图2.12所示。

![mark](http://pacdb2bfr.bkt.clouddn.com/blog/image/180712/EImFbmfHjb.png?imageslim)


此处可以保持默认，也可以在左侧选项中选择“中文”，右侧中选择“简体中文(中国)”。 需要注意的是此处选择的语言仅为安装过程中使用的语言，并不影响系统的最终语言。<span style="color:red;">嗯，这个要知道。</span>本例中左侧选择“中文”，右侧选择“简体中文(中国)”，单击Continue完成设置。

**步骤5：** 接下来安装程序将显示安装信息摘要界面，如图2.13所示。

![mark](http://pacdb2bfr.bkt.clouddn.com/blog/image/180712/ABfH1D7ej9.png?imageslim)

安装程序将需要用户设置的信息分为三个部分：本地化、软件和系统，完成这些设置后方可继续安装。


**步骤6：** 如图2.13所示，在本地化中系统已经按之前设置的语言预设了时区、键盘类型和语言支持三个选项，如需要修改直接鼠标单击对应的图标即可。首先日期和时间中的时区已经被设置为“亚洲/上海”，单击“日期和时间”弹出日期和时间设置窗口，如图2.14所示。

![mark](http://pacdb2bfr.bkt.clouddn.com/blog/image/180712/9ik5kgdLKa.png?imageslim)

在日期和时间设置窗口中，可以在地区和城市中选择需要使用的时区，也可以在下方地图中单击对应的区域来设置时区。网络时间设置是用来设置是否让操作系统自动从时间服务器同步时间，设置此项需要在系统设置中先设置网络。如果已经设置网络，可以拖动网络时间后面的滑块至开启位置即可，而如需对时间服务器进行设置，可以单击滑块右侧的齿轮按钮添加或删除时间服务器。<span style="color:red;">什么是时间服务器？怎么设置？为什么要用时间服务器？</span>

在窗口的下方可以设置当前日期和时间及时间显示的制式等，读者按需要进行设置即可，完成设置后单击左上方的“完成”按钮返回安装信息摘要界面。

本地化中的键盘选项已被设置为“汉语”，而语言支持选项中也已自动选择添加简体中文支持，通常都无须在做设置。


> 若选择英语作为系统的默认语言，也应该在语言支持中选择安装简体中文相关的软件包，否则某些中文命名的文件可能无法正常显示。<span style="color:red;">嗯。</span>

**步骤7：** 安装信息摘要界面中的软件部分，主要是用来定制需要安装的软件包及软件包的来源。其中安装源表示安装时软件包的来源，此时安装程序已自动将来源设置为本地介质即光盘，无须修改。软件选择选项表示安装操作系统时需要一并安装的软件， 默认设置为最小安装即只安装系统最基本的组件，单击软件选择进入软件定制界面，如图2.15所示。<span style="color:red;">还可以这样选择，嗯，不错，我之前手动安装过 ubuntu，好像没有看到过类似的选择。</span>

![mark](http://pacdb2bfr.bkt.clouddn.com/blog/image/180712/g43J3gJK6D.png?imageslim)

软件定制界面左侧是系统预定义的基本环境，按用途不同可以分为基础设施服务器、文件及打印服务器、基本网页服务器和虚拟化主机等。<span style="color:red;">这些服务器到底有什么不同？每次看到这些都想知道为什么要分这么多不同的种类？</span>右侧则为每个基本环境中附加软件选项，此处可以根据自身需求选择基本环境，需要注意的是某些基本环境默认没有安装图形界面，对于初学者此处可选择“GNOME桌面”。选择完成后单击左上角的“完成”按钮返回安装信息摘要界面，返回后安装程序将重新计算软件依赖关系，此过程中软件部分的选项将显示为灰色。

**步骤8：** 系统部分要求用户设置硬盘分区方案和网络连接，此时安装程序已自动将硬盘分区方案设置为自动分区，但要求用户确认，如图2.13所示。单击“安装位置”进入“安装目标位置”选择界面，如图2.16所示。

![mark](http://pacdb2bfr.bkt.clouddn.com/blog/image/180712/d8a9149m92.png?imageslim)

在安装目标位置界面中，首先需要用户确认安装的磁盘，此处已选择了一个本地磁盘 sda ， 容量为10.24GB,空闲空间为10.24GB。本地标准磁盘下面是存储添加区域，如果需要使用额外的存储，可以在设置网络之后单击“添加硬盘”选项添加额外的存储。最后的“其他存储选 项”中，可以选择手动分区和系统是否加密（通常不选择加密选项）。选择“我要配置分区”, 然后单击左上角的“完成”按钮进入分区界面，如图2.17所示。<span style="color:red;">还是不知道sda sdb 是什么意思？为什么会有这样的命名？</span>

![mark](http://pacdb2bfr.bkt.clouddn.com/blog/image/180712/21hc6e0ede.png?imageslim)

在"手动分区”界面中可以看到，这是一个新的CentOS 7安装，分区方案可以有多种选择，本例中将选择标准分区。然后单击下方的“+”添加分区，此时将弹出添加分区窗口，如图2.18所示。

![mark](http://pacdb2bfr.bkt.clouddn.com/blog/image/180712/7741AkeFHI.png?imageslim)

添加分区窗口主要有两项需要用户设置，第一项为挂载点即系统目录，第二项为期望容量，此处填入分区大小，默认单位为 `MB` ,但也可以使用如 `2GB` 、`100MB` 等形式。本例将使用最基本的分区方案，依次添加挂载点为 `/boot` 的引导分区，空间大小为 `500MB`,挂载点为 `swap` 的交换分区，大小为`2GB`，挂载点为根分区的`/`，期望容量不填（不填将默认使用剩余所有空间）<span style="color:red;">嗯。</span>。分区完成后将显示分区方案，如图2.19所示

![mark](http://pacdb2bfr.bkt.clouddn.com/blog/image/180712/4200HkEdji.png?imageslim)

在分区方案的右侧，还可以对分区进行一些调整，此处最主要的调整是调整文件系统类型。在本例中保持默认，单击左上角的“完成”按钮，将提示是否需要将分区方案保存到硬盘，单 击“接受更改”即可保存并返回安装信息摘要界面。

**步骤9：** 完成分区方案设置之后，接下来需要设置网络和主机名，单击“网络和主机名”弹出设置窗口，如图2.20所示。

![mark](http://pacdb2bfr.bkt.clouddn.com/blog/image/180712/aEGhe0C4aD.png?imageslim)


从界面左侧可以看到，安装程序发现了一张网卡命名为 enol6777736，并且网卡默认处于关闭状态。在界面左下侧安装程序已经设置了一个主机名，用户可以在此处输入新的主机名。

拖动界面右侧的滑块将网卡启用，如果使用的网络还需要设置 IP 地址等信息，可以单击 “配置”按钮，在弹出的窗口中选中“IPv4设置”，如图2.21所示。<span style="color:red;">一直不知道什么时候需要设置IP地址？为什么要设置？怎么设置？</span>

![mark](http://pacdb2bfr.bkt.clouddn.com/blog/image/180712/AfJlD2D8DB.png?imageslim)

可以看到系统默认使用 DHCP 的方式来获得 IP 地址等信息，如需设置IP地址可以在方法中选择“手动”，然后在地址中添加相应的IP地址、子网掩码和网关。DNS服务器地址应该填写在“附加DNS服务器”选项中，如果有多个DNS地址则使用逗号作分隔。如果虚拟机的网络设置为 Host-Only 和 NAT，此处应该设置为通过 DHCP 方式获得 IP 地址等信息。<span style="color:red;">这一段没有怎看懂。什么是DHCP？什么是DNS服务器？</span>

完成上述设置后，单击“保存”按钮返回网络和主机名设置界面，再单击左上角的“完成” 按钮返回安装信息摘要界面。

**步骤10：** 完成前面几步的设置之后，请再次确认每一项设置是否合适，特别是磁盘分区，因为到此时为止安装程序还没有修改磁盘中的数据。确认没有问题之后，单击右下角 的“开始安装”，安装程序会使用之前的设置开始系统的安装工作，如图2.22所示。

![mark](http://pacdb2bfr.bkt.clouddn.com/blog/image/180712/kAe37E75Dm.png?imageslim)


从图2.22中可以看到安装程序已经开始安装工作，但还需要对用户进行设置。其中“ROOT 密码”选项将设置root用户的密码，root用户通常也称为根用户，在Linux系统中拥有至高无上的权限（相当于Windows系统中的Administrator用户），因此如果在生产环境中，应当设置一个强度较高的密码。<span style="color:red;">嗯。</span>

由于root用户的权限太大，若用户登录并使用根用户误操作可能会带来一些不必要的麻 烦，例如输错一个字母删除系统中重要的数据等。因此系统强制要求创建一个普通用户，并使 用普通用户登录系统，必要时向root用户“申请”权利。<span style="color:red;">要怎么创建一个普通用户呢？而且关于linux 的权限，一直不是很清楚，比如说，一个程序能不能被一个普通的用户运行？一个程序能不能读取一个文件夹？等等。</span>

单击“创建用户”选项即可弹出创建用户窗口，填入全名、用户名、密码之后，单击左上 角的“完成”按钮即可返回安装界面。

> 如果在生产环境中设置密码，通常需要注意两点，其一是密码必须要有一定的长度，通常 建议设置为8~16位。其二是密码要具备一定的复杂性，复杂性通常用"四分之三原则”来衡量，即密码要包含构成密码的 4 种字符（大写字母、小写字母、数字和字符）中的 3 种。<span style="color:red;">哦，原来网上的设置密码的时候的显示复杂性的进度条是按照这个来的吗？</span>

**步骤11：** 设置完密码之后，等待安装程序安装完成（视计算机配置不同，此步可能需要20-40 分钟），安装结束时如图2.23所示。

![mark](http://pacdb2bfr.bkt.clouddn.com/blog/image/180712/m27I1DL63e.png?imageslim)

此时只需要单击 “重启”按钮，系统就会将最后的修改写入硬盘并重新启动系统，至此 CentOS7 就已经安装完成了。

### 2.3 U 盘安装 CentOS7

由于光盘使用不是非常方便，目前在计算机中安装操作系统多使用U盘，CentOS7 也可以使用U盘安装。本小节将简单介绍如何使用U盘安装 CentOS7。<span style="color:red;">嗯。相当于做一个U盘启动盘，现在这个USBwriter 是不是常用的用来做U盘启动盘的？之前我的印象笔记里好像记过，整理到这里来。</span>

首先需要下载一个名为 USBWriter 的软件，将U盘插入计算机的USB接口，确保系统能正常识别U盘，且U盘足够大（建议容量8GB）。然后打开 USBWriter,如图2.24所示。

![mark](http://pacdb2bfr.bkt.clouddn.com/blog/image/180712/49LHAfiHA3.png?imageslim)


单击Source后面的“Browse”按钮，在弹出的对话框中选择 CentOS7 的光盘映像文件， 然后在 Target 后面选择要使用的U盘。由于写入光盘映像会清空U盘中的所有数据，此步骤请慎重。<span style="color:red;">嗯，这一点要注意。</span>确定使用的U盘中没有任何有用数据之后，单击 “Write” 按钮开始写入映像文件。

待 USBWriter 写入完成，将U盘插入需要安装 CentOS7 的计算机上，然后使用U盘启动安装。之后的安装步骤与2.2.1中介绍的相同，此处不再赘述。<span style="color:red;">这个地方还需要补充一下，到底怎么设置从U盘启动安装？而且，从 linux 安装 linux 或者从 windows 安装linux 有哪些不同？都要说明一下的。</span>


> 并不是所有的U盘都可以写入光盘映像，某些U盘制作启动盘时，可能会失败。<span style="color:red;">是这样吗？为什么？</span>

### 2.4 Windows7 + CentOS7 双系统安装

由于虚拟机安装 CentOS 7 时会占用大量内存，对计算机要求相对较高，低配置的计算机运行可能会不太流畅，因此许多人将 Windows 和 CentOS 都安装到同一个计算机中。本小节将以 Windows 7 为例，介绍如何在一台计算上同时安装Windows和Linux,此处介绍的方法也适 合其他版本的Windows和Linux。<span style="color:red;">实际上感觉这样的同时安装两个系统很变扭。</span>

**(1)** 安装双系统应该先安装 Windows，因为 Windows 的引导装载程序无法引导Linux系统，但Linux系统的引导程序 Grub 则可以引导 Windows。因此应该先安装 Windows,然后再安装Linux，在 Linux 的引导程序中添加 Windows 引导选项。<span style="color:red;">什么是Grub？</span>

如果计算机中还没有安装Windows 7,即硬盘中还没有分区，在Windows 7安装时需要为 CentOS 7 预留足够的空间。这些空间可以不用分区，以空闲空间的形式存在即可，如图2.25所示。<span style="color:red;">还可以这样。</span>

![mark](http://pacdb2bfr.bkt.clouddn.com/blog/image/180712/d9GL8I4CGa.png?imageslim)

从图中可以看到磁盘0的容量约为80GB，其中分区 1 是由 Windows 7 安装程序自动分配 的系统保留空间，容量为48.7GB的分区2作为Windows 7 的系统分区，即C盘。分区 3 是分配给 Windows 7 使用的第二个分区，大小为19.5GB，而最后还有一个未分配空间，容量为 11.6GB,这个未分配空间就是留给CentOS 7的空间。

安装 Windows 7 时，也可以只添加系统盘，待系统安装完成后，再使用磁盘管理器进行分区并预留空间。由于需要将 Windows 7安装在分区2中，因此只需选中分区2并单击“下一步”继续安装即可。


> 由于本书的重点并非Windows的安装，故此略过Windows安装一节，Windows 7和其他 版本Windows的安装方法，读者可自行阅读相关文档或搜索相关视频了解。嗯。

**(2)** 如果计算机中已安装了 Windows 7且磁盘中已没有未分配的空闲空间，则可以使用 魔术分区大师等软件重新调整分区，将分区中的未使用空间调整为未分配空间。如果磁盘中还 有未使用的空间，则可在桌面上的“计算机”图标上单击右键，在弹出的菜单中选择“管理”, 然后在弹出计算机管理界面左侧依次选择“存储”和“磁盘管理”，如图2.26所示。

![mark](http://pacdb2bfr.bkt.clouddn.com/blog/image/180712/F9fHebdjJ0.png?imageslim)

如果系统中还有多余没有分配的空闲空间，此时可以在未分配空间上单击右键，添加分区。 最后剩余一部分空间作为 CentOS 7的预留空间。如图2.26 所示，己经为CentOS 7预留了一 个10.66GB的未分配空间。

**(3)** 完成上述步骤后，重新启动系统，修改 BIOS 设置并使用安装光盘或U盘启动系统 <span style="color:red;">这个地方要说明下，怎么设置的，而且后面要怎么改回来？</span>, 然后安装CentOS 7,安装过程与2.2.1节中介绍的相同，此处不再赘述。安装完成后登录系统, 在桌面上单击右键，选择“在终端中打开”，此时将弹出终端窗口。接下来相修改CentOS 7 引导装载程序的配置文件，并添加Windows 7的引导选项。

在终端窗口中输入命令“su-root”，然后输入root用户密码切换到root用卢，需要注意的是输入密码时终端内不会有任何显示，输入完成后按Enter键即可。切换成 root 用户后，命令提示符将变为 “[root@localhost ~]#”，输入命令 `gedit /boot/grub2/grub.cfg` 按 `Enter` 键，此命令表示使用 gedit 编辑器打开 Grub 的配置文件/`boot/grub2/grub.cfg`。待 gedit 打开后，依次单击菜单中的“搜索”和“跳转到行”，在弹出的对话框中输入70，此时光标将跳转到第70行。

如图2.27所示，在原有的菜单条目  `menuentry` 之后加上 Windows 7 的引导选项。引导项中 `Windows 7` 表示启动时，Grub显示的菜单名称，`set root=(hdO,1)` 表示 Windows 引导的设备为第 0 块磁盘的第 1 个分区（此处需要按实际情况设置），而其后的 `chainloader+1` 表示加载 Windows 的引导程序。

![mark](http://pacdb2bfr.bkt.clouddn.com/blog/image/180712/AlBcDfA42j.png?imageslim)

完成以上操作后，保存退出并重启系统，待系统重启后可以发现 CentOS 7 的引导菜单中多了 Windows 7 的引导选项，如图2.28所示。
![mark](http://pacdb2bfr.bkt.clouddn.com/blog/image/180712/gB4jCdiEIg.png?imageslim)

从图2.28中可以看出，引导菜单中已有Windows 7选项，此时只需要使用向上方向键选 中该选项并按Enter键即可引导进入Windows 7。

### 2.5网络安装

网络安装分为两种模式，一种是使用 NetInstall 版（网络安装版），使用这个版本安装需要通过网络下载安装所需的软件包；另一种方式是使用 PXE 网络启动的方式安装，这种方式适用于大规模自动化安装，例如一次性安装100台计算机，井且这些计算机的分区方案都相同。由于 PXE 网络启动安装方式比较复杂且实用性不太多，此处不作介绍，读者可自行阅读相关文档了解，本小节将介绍如何使用网络安装版的使用方法。<span style="color:red;">PXE 不是大规模自动化安装的唯一方法吗？为什么说实用性不太多？难道是因为基本上买来的电脑都已经安装好 linux 了？还是要看下大规模自动化安装是怎么安装的。</span>

网络安装通常适用于不能使用 DVD 和 U 盘的环境，读者仍可以使用虚拟机模拟安装。首 先需要下载 Netlnstall 版的光盘映像文件，接下来需要让虚拟机能正常访问网络，这时网络连 接方式一般选择桥接或NAT，视宿主机网络环境而定。接下来使用 NetInstall 版光盘映像启动虚拟机，之后的操作与 2.1 中介绍的相同，直到进入安装信息摘要界面。

在 NetInstall 版的安装信息摘要界面中，会要求用户设置安装源。首先需要设置网络，可以单击“网络和主机名”进行设置，请参考 2.1 节中的介绍，此处不再赘述。完成网络设置 后，单击“安装源”进行设置，如图2.29所示。

![mark](http://pacdb2bfr.bkt.clouddn.com/blog/image/180712/I19HlHa5Jf.png?imageslim)


如图2.29所示在安装源中输入地址即可，此处使用的是网易的安装源，读者也可以从 CentOS官网上查询并使用其他安装源。设置完安装源之后，其他设置和安装方法与2.2.1小节 中介绍的相同，此处不再赘述。

> 也可以通过解压DVD安装光盘映像的方式自建安装源，但由于光盘文件名长度限制，光盘中解压出的目录repodata和Packages中有许多文件名有误，需要修正才能使用。<span style="color:red;">竟然还可以自建安装源？怎么搭建的？而且，错误的文件名要怎么修正？调整光盘名长度限制吗？想确认下。</span>
