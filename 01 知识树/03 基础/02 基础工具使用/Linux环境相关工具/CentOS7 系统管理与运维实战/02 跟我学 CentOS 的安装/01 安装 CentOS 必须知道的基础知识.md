# 第二章 跟我学 CentOS 的安装

学习 Linux 首先要了解 Linux 的安装。安装 Linux 有多种方法，可以直接将 Linux 安装到某台机器上，也可以采用虚拟机安装。本章首先介绍虚拟机的相关知识，演示如何在虚拟机上安装 Linux，然后介绍 Linux 的其他安装方式。通过本章，读者可以掌握 Linux 的系统安装过程。

本章主要涉及的知识点有：

- 认识虚拟机
- 如何安装Linux
- 安装后如何进行配置
- 旧版本如何升级

## 1 安装CentOS必须知道的基础知识

作为一个企业使用的专业操作系统，直接使用 CentOS 对初学者有较大难度。这是因为 CentOS 中有许多非常专业的概念和软件结构，在正式开始之前，本节将介绍安装 CentOS 必须知道的一些基础知识。

### 1.1 磁盘分区

安装一个全新的 CentOS 如同安装全新的 Windows 一样，都需要先对磁盘进行分区。对于个人学习用户而言，推荐读者使用一个比较合理的静态分区方案。一方面静态分区方案不太复杂，另一方面手动进行分区方案(而不是由安装程序自行分区)可以认识 Linux 系统中各目录的作用。<span style="color:red;">难道还可以动态分区？</span>

在Windows系统中，分区类型是一个已经被淡化的概念，但在Linux系统分区时，这些概念依然存在。<span style="color:red;">是的，windows 中基本很少再会特意提到软件应该放在那个区。</span>因此首先介绍一下分区类型：

1. 主分区：主分区可以直接用来存放数据，但在一个硬盘上主分区最多只能有 4 个， 因此如果想在一个硬盘上创建 4 个以上分区，光主分区是不够的。<span style="color:red;">为什么主分区在一个硬盘上只能是4个？</span>

2. 扩展分区：扩展分区也是一种主分区，但扩展分区不能用来存放数据，但可以在扩展分区之上再划分可以存放数据的逻辑分区。<span style="color:red;">扩展分区也是一种主分区？也在4个之中吗？扩展分区不能用来存放数据是什么意思？</span>

3. 逻辑分区：逻辑分区是在扩展分区的基础上建立的，可以用来存放数据。

从上面的介绍中可以看出，如果需要划分4个以上分区，就必须使用扩展分区，然后在扩展分区的基础上划分多个逻辑分区。<span style="color:red;">嗯，大概明白了，但是如果有图示就更好了。</span>

明白了分区类型的概念之后，安装CentOS时还需要制订一个分区方案。在制订分区方案之前首先需要明确一个概念，在Windows系统中，不同的分区被使用C、D、E等盘符替代， 只要进入这些盘符就进入了相应的分区。但**在Linux系统中没有盘符的概念，不同的分区被挂在不同的目录下面，这个过程称为挂载，目录称为挂载点。只要进入挂载点目录就进入了相应的分区**，这样做的好处是用户可以按自己的需要为某个目录单独扩展空间。<span style="color:red;">什么叫好处是可以按照自己的需要为某个目录单独扩展空间？难道 windows 没有这个功能就不好吗？</span>

制订分区方案首先需要了解自己的需求，生产环境中的系统分区与以学习为目的的分区方案肯定不同。对于以学习为目的的初学者而言，一个最简单的分区方案应该包括以下内容：

1. `/boot`：创建一个约 `3OOMB-5OOMB` 的分区挂载到 `/boot` 下面，这个分区主要用来存放系统引导时使用的文件，通常我们称为引导分区。<span style="color:red;">一直想知道什么叫系统引导时使用的文件？到底什么时候使用的？里面有什么？系统怎么知道要从这里启动的？</span>

2. `swap` 分区：这个分区没有挂载点，大小通常为内存的 2 倍。系统运行时，当物理内存不足时，系统会将内存中不常用的数据存放到 swap 中，即 swap 此时被当作了虚拟内存。<span style="color:red;">嗯。</span>

3. 根分区`/`：根分区的挂载点是`/`，这个目录是系统的起点，可以将剩余的空间都分到这个分区中。此时该分区中包含了用户家目录、配置文件、数据文件等内容，初学者系统中的这些数据都不会太多，因此推荐将他们都放在一起。<span style="color:red;">这个地方就不明白了，根分区的 `/` 和 `/boot` 是什么关系？他们之间是并列关系吗？感觉 `/boot` 就在 `/` 里面呀？是不是？明确下。</span>

以上就是一个最简单的分区方案，初学者也可以尝试将再多几个分区，将其他目录也挂载到分区中，例如分一个 500MB 的分区挂载到用户家目录 `/home` 下面。

如果是生产环境就需要根据具体业务来决定分区方案，生产环境分区方案一般奉行系统、软件与数据分开的原则。即操作系统和应用软件放在本地硬盘上，数据单独存放于存储或单独的分区中，这种方案一方面分类清晰，读写速度相对更快；另一方面即使存放系统和软件的硬盘损坏，数据也不会有所损失。<span style="color:red;">这样是怎么分区的？要明确下。</span>

> 分区类型在安装操作系统时不会有具体体现，但在操作系统安装完成后使用 fdisk 等工具添加新硬盘分区时会用到。<span style="color:red;">fdisk 是什么？怎么使用？是在小黑框里使用的吗？</span>

### 1.2 静态分区的缺点及逻辑卷管理简介

对于普通用户而言，直接对硬盘分区然后挂载这种使用静态分区的方法几乎没有什么问题。但对于某些特定的生产环境而言，这种方法弊大于利。例如要求不间断运行的数据库中心, 这类服务会随时间增加逐渐占用大量硬盘空间。<span style="color:red;">嗯，是的，这种情况怎么办呢？而且，如果这个数据中心大的超过了一个硬盘怎么办？</span>如果使用静态分区方案，这类服务会在硬盘空间耗尽后自动停止，即使运维工程师及早发现，也会在更换硬盘时停止服务。因此这类要求不间断运行的服务，最好不要使用静态分区方案。<span style="color:red;">是的，这个要怎么实现？</span>

为了防止需要不间断运行服务因硬盘空间耗尽而停止，此时应该采用更加先进的逻辑卷管理（Logical Volume Manager,逻辑卷管理常简写为 LVM ）方案。LVM先将硬盘分区转化为物理卷（PV），然后将物理卷组成卷组（VG），然后在卷组的基础上再划分逻辑卷（LV），最后就可以使用逻辑卷存放数据了。使用逻辑卷有以下优点：

1. 可以解决硬盘空间不足，需要停止服务迁移数据的问题。虽然在划分逻辑卷时指定了大小，但只要卷组中还有剩余空间，就可为逻辑卷扩容，扩容过程是在线进行的，这意味着无须停止服务就可以进行。即使卷组中没有剩余空间，也可以向卷组添加新物理卷为卷组扩容。<span style="color:red;">这个挺好。</span>

2. 当硬盘空间不足时，可以添加更大的硬盘，从而将卷组中那些容量较小的硬盘移出卷组，这个过程也可以在线进行，无须关闭服务。<span style="color:red;">这个有些厉害了，将卷组中的容量较小的硬盘移除卷组。厉害。</span>

3. 可以为逻辑卷添加快照卷，利用这一功能可以实现数据备份等操作，而无须担心数据的一致性受到影响。<span style="color:red;">这个也挺厉害。</span>

逻辑卷管理还有许多其他可能，例如减小逻辑卷空间等，此处不再一一介绍，感兴趣的读者可以自行阅读相关文档了解。虽然逻辑卷有诸多好处，但依然建议初学者在安装系统时使用静态分区，待系统安装好之后再学习逻辑卷操作。<span style="color:red;">嗯，不知道这个逻辑卷的使用这本书讲了没，如果没有讲还是要添加进来的。</span>

### 1.3 虚拟化和 VMware Workstation 简介

虚拟化技术是指在一台计算机上同时运行多个逻辑计算机，这些逻辑计算机可以运行不同的操作系统，拥有相互独立的 CPU、内存等硬件，运行时互相不影响。虚拟化技术的好处是将 CPU、 内存等硬件资源实现动态分配、灵活高度使用，从而提高资源的利用效率。如今虚拟化厂商和相 关的虚拟化软件有许多，但对于初学者普遍推荐使用VMware公司的 Workstation 。<span style="color:red;">嗯，这个用过。</span>

VMware公司是最早从事虚拟化技术的公司之一，也是虚拟化技术的领导厂商，公司针对不同的客户需求开发了许多虚拟化产品。例如针对个人桌面的 Workstation，用于企业环境的 VMware vSphere 等。本书中多使用 VMware Workstation 作演示，VMware Workstation 运行时 界面如图2.1所示。

![mark](http://pacdb2bfr.bkt.clouddn.com/blog/image/180711/caEbmAFEkL.png?imageslim)

Workstation 可以虚拟许多操作系统，例如 Windows 7、各种发行版的 Linux 和 Unix、Solaris、 Novell NetWare等。为了读者能更好地使用Workstation，现将一些常见使用技巧列举如下：

1. 虚拟机的监视器：打开某个虚拟机的电源之后，Workstation 会自动显示虚拟机监视器。将鼠标移动到监视器内并单击，Workstation 会自动将鼠标和键盘的控制权交给正在运行的虚拟机。如果要让宿主计算机重新获得鼠标和键盘的控制权，可以使用 `Alt+Ctrl` 快捷键。

2. 当虚拟机获得鼠标和键盘的控制权后，可以进行任何输入和控制，但使用组合键 `Alt+Ctrl+Del` 将被宿主计算机获得，此时可以使用 `Alt+Ctrl+Insert` 替代或在菜单栏的虚拟机下面单击发送`Alt+Ctrl+Del`。<span style="color:red;">嗯，这个不知道，之前也没用过</span>

3. Workstation为虚拟机提供了多种网络：如果要让虚拟机使用宿主机的网络可以使用桥接模式(bridged)；如果仅想让虚拟机连接网络可以选择 NAT 模式；如果只想让宿主机与虚拟机通信可以使用仅主机模式 (Host-Only)；如果宿主机有多个网络，可以在虚拟网络编辑器中设置。<span style="color:red;">嗯，对于这些模式一直不是很清楚。</span>

4. Workstation 附带有快照功能，使用快照功能将虚拟机保持在某一刻，使用一段时间后返回作快照的时刻。<span style="color:red;">这个功能挺好的，我应该闲的没事的时候用过</span>

Workstation 是一个功能十分强大的虚拟化软件，其使用方法和技巧有很多，此处不再一一介绍，感兴趣的读者可以自行阅读相关文档了解。<span style="color:red;">不知道需要了解到什么程度？</span>

VMware Workstation 是一个收费软件，读者完全可以选择 Oracle VM VirtualBox 这类免费软件来替代。

### 1.4 下载最新的CentOS安装版本

目前最新的版本为CentOS 7,要安装首先需要从其官方网站上下载，其官方网站为 (http://www.centos.org/) 然后在搜索结果中选择其官方网站访问，如图2.2所示。

![mark](http://pacdb2bfr.bkt.clouddn.com/blog/image/180711/2BAj2HIhiJ.png?imageslim)

在其官方网站中单击左上方的“GET CENTOS”或单击下方的 “Get CentOS 7 Now” 按钮，在下载页面中选择安装镜像类型。此处选择 “DVD ISO” 标准安装镜像即可，接下来的页面将选择从哪个镜像站点下载，国内通常可以使用网易、中国科技大学(网址开头为 http://centos.ustc.edu.cn ）等速度不错的站点。<span style="color:red;">嗯。</span>

除了 DVD 标准安装镜像之外，还有 Everything 版（完整版安装光盘）、Netlnstall 版（网络安装映像）等，这些安装映像都可以从 https://mirrors.163.com/centos/ 下载。<span style="color:red;">这些版本有什么区别吗？没有说吗，想知道。</span>


> 下载完成后是一个扩展名为iso的光盘映像文件，可以使用软碟通等软件将光盘映像文件刻录为光盘使用，虚拟机也可以直接使用映像文件作为光盘使用。<span style="color:red;">嗯。</span>
