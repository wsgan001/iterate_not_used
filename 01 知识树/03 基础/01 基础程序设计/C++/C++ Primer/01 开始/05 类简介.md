

##### 1.5类简介

在解决书店程序之前，我们还需要了解的唯一一个C++特性，就是如何定义一个数据 结构(data structure)来表示销售数据。在C++中，我们通过定义一个类(class)来定义 自己的数据结构。一个类定义了一个类型，以及与其关联的一组操作。类机制是C++最重 要的特性之一。实际上，C++最初的一个设计焦点就是能定义使用上像内置类型一样自然 的类类型(classtype)。

在本节中，我们将介绍一个在编写书店程序中会用到的简单的类。当我们在后续章节 中学习了更多关于类型、表达式、语句和函数的知识后，会真正实现这个类。

为了使用类，我们需要了解三件事情：

•类名是什么？

•它是在哪里定义的？

•它支持什么操作？

对于书店程序来说，我们假定类名为Sales_item,头文件Sales_item.h中td经定义 了这个类。

如前所见，为了使用标准库设施，我们必须包含相关的头文件。类似的，我们也需要 使用头文件来访问为自己的应用程序所定义的类。习惯上，头文件根据其中定义的类的名 字来命名。我们通常使用.h作为头文件的后缀，但也有一些程序员习惯.H、.hpp或.hxx。标 准库头文件通常不带后缀。编译器一般不关心头文件名的形式，但有的IDE对此有特定要求。

< 20 1



###### 1.5.1 Sales_item 类

Sales_item类的作用是表示一本书的总销售额、售出册数和平均售价。我们现在不 关心这些数如何存储、如何计算。为了使用一个类，我们不必关心它是如何实现的，只 需知道类对象可以执行什么操作。

每个类实际上都定义了一个新的类型，其类型名就是类名。因此，我们的Sales_item 类定义了一个名为SaleS_item的类型。与内置类型一样，我们可以定义类类型变量。 当我们写下如下语句

Sales_item item;

是想表达item是一个Sales_item类型的对象。我们通常将“一个Sales_item类型 的对象”简单说成“一个Sales_item对象”，或更简单的“一个Sales_item”。

除了可以定义SaleS_item类型的变量之外，我们还可以：

•调用一个名为isbn的函数从一个Sales_item对象中提取ISBN书号。

•用输入运算符（》）和输出运算符（《）读、写Sales_item类型的对象。

•用赋值运算符（=）将一个Sales_item对象的值赋予另一个Sales_item对象。 •用加法运算符（+ ）将两个Sales_item对象相加。两个对象必须表示同一本书（相

同的ISBN）。加法结果是一个新的Sales_item对象，其ISBN与两个运算对象 相同，而其总销售额和售出册数则是两个运算对象的对应值之和。

•使用复合赋值运算符（+=）将一个Sales_item对象加到另一个对象上。

又键概念：类定义了行力

当你读这些程序时，一件要牢记的重要事情是，类Sales_item的作者定义了类对 象可以执行的所有动作。即，Sales_item类定义了创建一个Sales_item对象时会发 生什么事情，以及对Sales_item对i进行赋值、加法或输入檎出运算时会发生什么事情。

一般而言.类的作者决定了类类型对象上可以使用的所有操作。当前，我们所知道 的可以在Sales_item对象上执行的全部操作就是本节所列出的那些操作。

I 21〉读写 Sales item

既然已经知道可以对Sales_item对象执行哪些操作，我们现在就可以编写使用类 的程序了。例如，下面的程序从标准输入读入数据，存入一个Sales_item对象中，然 后将Sales_item的内容写回到标准输出：

\#include <iostream>

\#include "Sales_item.h" int main（）

{

Sales_item book;

//读入ISBN号、售出的册数以及销售价格 std::cin » book;

//写入ISBN、售出的册数、总销售额和平均价格 std::cout << book « std::endl; return 0;

}

如果输入：

0-201-70353-X 4 24.99

则输出为：

0-201-70353-X 4 99.96 24.99

输入表示我们以每本24.99美元的价格售出了 4册书，而输出告诉我们总售出册数为4, 总销售额为99.96美元，而每册书的平均销售价格为24.99美元。

此程序以两个#include指令开始，其中一个使用了新的形式。包含来自标准库的头

文件时，也应该用尖括号(< >)包围头文件名。对于不属于标准库的头文件，则用双引 号("")包围。

在main中我们定义了一个名为book的对象，用来保存从标准输入读取出的数据， 下一条语句读取数据存入对象中，第三条语句将对象打印到标准输出上并打印一个endlo

Sales item对象的加法

下面是一个更有意思的例子，将两个SaleS_item对象相加:

\#include <iostream>

\#include "Sales_item•h" int main()

{

Sales_item iteml, item2;

std: : cin >> iteml » item2;    // 读取一^十交易记录

std: :cout « iteml + item2 « std: :endl; // 打印它们的和 return 0;

}

如果输入如下内容：

<~22~1



0-201-78345-X 3 20.00 0-201-78345-X 2 25.00

则输出为：

0-201-78345-X 5 110 22

此程序开始包含了 Sales_item和iostream两个头文件。然后定义了两个 SaleS_item对象来保存销售记录。我们从标准输入读取数据，存入两个对象之中。输出 表达式完成加法运算并打印结果。

值得注意的是，此程序看起来与第5页的程序非常相似：读取两个输入数据并输出它 们的和。造成如此相似的原因是，我们只不过将运算对象从两个整数变为两个 SaleS_item而已，但读取与打印和的运算方式没有发生任何变化。两个程序的另一个不 同之处是，“和”的概念是完全不一样的。对于int,我们计算传统意义上的和一两个 数值的算术加法结果。对于Sales_item对象，我们用了一个全新的“和”的概念——两 个Sales_item对象的成员对应相加的结果。

使用文件琅定向

当你测试程序时，反复从键盘敲入这些销售记录作为程序的输入，是非常乏味的u 大多数操作•系统支持文件重定向，这种机制允许我们将标准输入和标准输出与命名文件 关联起来：

$ addlterns <infile >outfile

假定$是操作系统提示符，我们的加法程序已经编译为名为addltems.exe的可执行文 件(在UNIX中是addltems ),则上述命令会从一个名为infile的文件读取销售记 录，并将输出结果写入到一个名为outfile的文件中，两个文件都位于当前目录中

###### 1.5.1节练习

练习 1.20:在网站 <http://www.informit.com/title/0321714113> _t.第 1 章的代 码目录中包含了头文件SaleS_item.h。将它拷贝到你自己的工作目录中。用它编写一 个程序，读取一组书籍销售记录，将每条记录打印到标准输出上。

练习1.21:编写程序，读取两个ISBN相同的Sales_iteni对象，输出它们的和。 练习1.22:编写程序，读取多个具有相同ISBN的销售记录，输出所有记录的和。

###### 1.5.2初识成员函数

将两个Sales_item对象相加的程序首先应该检査两个对象是否具有相同的ISBN。 方法如下：

\#include <iostream>

\#include "Sales_item.h" int main()

{

Sales_item iteml, item2; std::cin >> iteml » item2;

//首先检查iteml和item2是否表示相同的书 if (iteml.isbn () = item2.isbn()) {

std::cout << iteml + item2 << std::endl; return 0;    //表示成功

} else {

std::cerr « "Data must refer to same ISBN"

« std::endl;

return -1;    //表示失败

}

}

此程序与上一版本的差别是if语句及其else分支。即使不了解这个if语句的检 测条件，我们也很容易理解这个程序在干什么。如果条件成立，如上一版本一样，程序打 印计算结果，并返回0,表明成功。如果条件失败，我们执行跟在else之后的语句块， 打印一条错误信息，并返回一个错误标识。

什么是成员函数？

这个if语句的检测条件 iteml.isbn() == item2.isbn()

调用名为isbn的成员函数(memberfunction)o成员函数是定义为类的•部分的函数，有 时也被称为方法(method)。

我们通常以一个类对象的名义来调用成员函数。例如，上面相等表达式左侧运算对象 的第一部分

iteml.isbn (>

使用点运算符(.)来表达我们需要“名为iteml的对象的isbn成员”。点运算符只能用 于类类型的对象。其左侧运算对象必须是一个类类型的对象，右侧运算对象必须是该类型 的一个成员名，运算结果为右侧运算对象指定的成员。

当用点运算符访问一个成员函数时，通常我们是想(效果也确实是)调用该函■数■。既 们使用调用运算符(())来调用一个函数。调用运算符是一对圆括号，里面放置实参 (argument)列表(可能为空)=成员函数isbn并不接受参数。因此

iteml.isbn()

调用名为iteml的对象的成员函数isbn,此函数返回iteml中保存的ISBN书号。

<24~|



在这个if条件中，相等运算符的右侧运算对象也是这样执行的——它返回保存在 item2中的ISBN书号。如果ISBN相同，条件为真，否则为假。

###### 1.5.2节练习

练习1.23:编写程序，读取多条销售记录，并统计每个ISBN (每本书)有几条销售记 录。

练习1.24:输入表示多个ISBN的多条销售记录来测试上一个程序，每个ISBN的记录 应该聚在一起。
