## 第 2 章 序列构成的数组

你可能注意到了，之前提到的几个操作可以无差别地应用于文本、列表和表格上。我

们把文本、列表和表格叫作数据火车+ + + + + + FOR命令通常能作用于数据火车上。1

——Geurts、 Meertens 和 Pemberton ABC Programmer's Handbook

| xLeo Geurts, Lambert Meertens, and Steven Pemberton, ABC Programmer's Handbook, p. 8.

在创造 Python 以前， Guido 曾为 ABC 语言贡献过代码。 ABC 语言是一个致力于为初学者 设计编程环境的长达 10 年的研究项目，其中很多点子在现在看来都很有 Python 风格：序 列的泛型操作、内置的元组和映射类型、用缩进来架构的源码、无需变量声明的强类型， 等等。 Python 对开发者如此友好，根源就在这里。

Python 也从 ABC 那里继承了用统一的风格去处理序列数据这一特点。不管是哪种数据结 构，字符串、列表、字节序列、数组、 XML 元素，抑或是数据库查询结果，它们都共用 一套丰富的操作：迭代、切片、排序，还有拼接。

深入理解 Python 中的不同序列类型，不但能让我们避免重新发明轮子，它们的 API 还能 帮助我们把自己定义的 API 设计得跟原生的序列一样，或者是跟未来可能出现的序列类 型保持兼容。

本章讨论的内容几乎可以应用到所有的序列类型上，从我们熟悉的list，到Pyhon3中 特有的str和bytes。我还会特别提到跟列表、元组、数组以及队列有关的话题。但是

Unicode 字符串和字节序列这方面的内容被放在了第 4 章。另外这里讨论的数据结构都是

Python 中现成可用的，如果你想知道怎样创建自己的序列类型，那得等到第 10 章。

### 2.1 内置序列类型概览

Python 标准库用 C 实现了丰富的序列类型，列举如下。

容器序列

list、tuple 和 collections.deque 这些序列能存放不同类型的数据。

扁平序列

str、bytes、bytearray、memoryview 和 array.array，这类序列只能容纳一种

类型。

容器序列存放的是它们所包含的任意类型的对象的引用，而扁平序列里存放的是值而不

是引用。换句话说，扁平序列其实是一段连续的内存空间。由此可见扁平序列其实更加紧

凑，但是它里面只能存放诸如字符、字节和数值这种基础类型。

序列类型还能按照能否被修改来分类。

可变序列

list、 bytearray、 array.array、 collections.deque 和 memoryview。 不可变序列

tuple、 str 和 bytes。

图2-1显示了可变序列(MutableSequence)和不可变序列(Sequence)的差异，同时 也能看出前者从后者那里继承了一些方法。虽然内置的序列类型并不是直接从 Sequence 和MutableSequence这两个抽象基类(Abstract Base Class，ABC)继承而来的，但是了

解这些基类可以帮助我们总结出那些完整的序列类型包含了哪些功能。

图 2-1：这个 UML 类图列举了 collections.abc 中的几个类(超类在左边，箭头从

子类指向超类，斜体名称代表抽象类和抽象方法)

通过记住这些类的共有特性，把可变与不可变序列或是容器与扁平序列的概念融会贯通，

在探索并学习新的序列类型时，你会更加得心应手。

最重要也最基础的序列类型应该就是列表(list) 了。list是一个可变序列，并且能同 时存放不同类型的元素。作为这本书的读者，我想你应该对它很了解了，因此让我们直接 开始讨论列表推导(list comprehension)吧。列表推导是一种构建列表的方法，它异常强

大，然而由于相关的句法比较晦涩，人们往往不愿意去用它。掌握列表推导还可以为我们

打开生成器表达式(generator expression)的大门，后者具有生成各种类型的元素并用它 们来填充序列的功能。下一节就来看看这两个概念。
