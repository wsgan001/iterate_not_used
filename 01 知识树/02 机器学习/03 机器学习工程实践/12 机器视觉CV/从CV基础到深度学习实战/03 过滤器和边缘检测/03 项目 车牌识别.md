# 车牌识别


下面我们开始讲今天的项目：

做 OCR 相关的，一些细节还是要自己去看一下的，这里只是大概讲一下：

车牌识别，主要是车牌的定位，和文字的识别。尤其是在光线很暗的情况下，老师提到了一个下雨的时候怎么把雨水的影响去除掉。

在实际工业中应用的时候，很多的理论上看起来比较简单的算法在实际中有很重要的作用。

下面介绍一下车牌识别的流程和技术方法：

比如某个环节要使用那些技术。

车牌识别是一个老话题，也叫做 自动车牌识别 ANPR。

- 图像分割
- 特征提取
- 模式识别
    - Support vector machine
    - Artificial neural network



车牌识别有两个步骤：

1. 车牌的检测
2. 车牌的识别


车牌的检测就是获得车牌在图像中的位置。涉及到：

- 图像的分割
- 特征的提取

我们一副图像可能拿到多个车牌的位置，然后交给我们的识别方法进行验证。

下面这个图是主要的算法的步骤：


![mark](http://pacdb2bfr.bkt.clouddn.com/blog/image/180808/FcAjGh8ACI.png?imageslim)


图像分割：会从一副图像中获得感兴趣的块，
比如一个 200*200 的图像，我们车牌的大小是 20*10 ，如果是枚举，那么计算量非常大，所以，我们要进行一个 proposal 的过程，后面我们讲 cnn 的时候也会做这样的操作。

特征提取，是对字符图像的每一个部分进行提取，

### 我们看一下车牌的检测与定位

![mark](http://pacdb2bfr.bkt.clouddn.com/blog/image/180808/H00jJma30L.png?imageslim)

从一个最原始的图像到一个车牌。

这个步骤分为两部分：

- 图像分割
- 对分割图像进行分类

今天我们主要讲检测与定位，对后面的字符识别，后面讲 NN 的时候会讲到。

首先，我们拿到原图像进行灰度转换，从 RGB 到 RGBIR 到灰度。这个地方之所以要转，是因为颜色信息用不到，后面可能会用到车牌底色是蓝色还是白色还是黄色。<span style="color:red;">什么时候会用到车牌的颜色？</span>

注：在车牌检测的时候，很多时候是拿到的红外图像，因为我们车牌上面的材料不同，因此很多时候拿到的都是由 IR 的。<span style="color:red;">IR 是什么？红外图像与普通的图像有区别吗？</span>

转成灰度之后，才正式开始，这个灰度图像就是我们的输入，我们第一步要做得就是图像滤波，我们使用高斯滤波来去燥，这是我们必须要做的。

然后开始找边缘，车牌定位的时候，我们主要找的竖直边缘，第一张图就是用的 sobel 滤波器找的竖直边缘，为什么要找竖直，因为这个与任务有关

得到粗边缘之后，进行阈值化，阈值化的方法有自适应的、DTSU 大金算法 等，这都是很常用的。

在拿到了一个有很多噪点的边缘图像之后，我们接下来常做的就是形态学，这里面用的是闭操作，删除竖直边缘之间的空白区域，把该联通的区域联通，这样我们就把一些小的不连续的边缘去掉了，见第一行的第三张图。这样就得到了一些可能的区域，包括车牌的位置，也包括一些不是车牌的位置。<span style="color:red;">形态学是什么？一般什么情况下使用？</span>

下面我们可以用矩形框来逼近连通区域的形状。在这一步之前，我们先做了一个模板，比如说，当把背景图像用漫水填充，相当于把背景去掉。这样，我们用矩形拟合的数量就会少一些。<span style="color:red;">怎么做漫水填充的？怎么知道什么是背景的？怎么用矩形拟合的？</span>

从第二行第二幅图上，可以看到，有很多的红色的矩形框，我们会在原图像上拿到若干个可能的车牌的位置，由于我们找的是车牌，因此长宽比是固定的，因此很多直接就去除掉，

我们拿到了可能的车牌的位置，把这个位置进行缩放，或者说仿射变换，因为这是一个摄像机从高处拍的照片，因此会有一个仿射的存在，因此这个车牌的图像是扭曲的，我们需要把它转换成一个标准的矩形，因此，我们把所有的可能的区域转化成一个固定大小的区域图像，这样就从原图像得到了若干个大小相同的一些可能的车牌区域。

做到这一步，得到了很多的大小相同的可能的车牌图像，就已经完成了图像的分割。


接下来，我们讲一下车牌检测中的分类操作：

![mark](http://pacdb2bfr.bkt.clouddn.com/blog/image/180808/d31j223565.png?imageslim)

在分类中，我们要对之前取到的一些矩形进行分类，来决定他是否是车牌。这里面我们用到的就是 SVM 的分类方法。老师说 SVM 是最好的分类方法，没有之一。<span style="color:red;">嗯，之前不知道 SVM 名气这么大。</span>


这个地方的 SVM 与上一讲一样，我们直接用的是上面这个处理好的小矩形内的像素，没有进行任何操作，比如 m*n 的图像转成 1*(mn) 然后就直接给机器学习进行运算了。


为了简单理解机器学习如何工作，我们这里直接使用的是像素，但是其实可以使用 PCA 、傅里叶变换、文理分析等等。<span style="color:red;">PCA、傅里叶变换、文理分析要怎么做？</span>

一般，我们在用的时候，车牌识别的分类器都是已经做好的，一般不需要自己训练，因为自己训练样本量一般太少，我们一般是用一个训练好的SVM 分类器。

使用上面的SVM 模型对我们取到的几个小矩形进行分类，我们最后就会得到一个 SVM 给出的唯一的一个车牌的位置。

到这里，我们就完成了车牌的检测与定位。


### 字符识别

下面，我们就根据我们拿到的车牌的位置进行光学字符识别。

![mark](http://pacdb2bfr.bkt.clouddn.com/blog/image/180808/eGjek7mfAg.png?imageslim)


对于一个车牌，可以着手按照每个字符来分割车牌，用的方法就是 ANN 也叫人工神经网络。这种机器学习方法来识别字符叫做光学字符识别 OCR。

我们拿到的图像进行阈值分割之后，得到二值化图像，并将处理后的图像通过查找轮廓找到每个字符可能的位置，对于每个检测的轮廓，需要验证大小，并且删除所有尺寸较小的，或者长宽比不正确的。

这种约定长宽比在车牌识别中还是使用的比较多的。因为我们的车牌号的数字都是固定尺寸的，因此可以通过这种方法去掉很多的噪声，可以给识别的稳定性提供保障。

这样我们会检测出来很多字符的位置。

然后，我们把每个字符调成同样的大小。

下面，我们就不直接用的像素了，在 OCR 里面，我们使用的是累计直方图。比如说我们拿到的是一个 5*5 的字符图像，而由于每个字符占的像素不同，因此，我们可以得到水平方向直方图和竖直方向直方图：<span style="color:red;">没想到还可以这样，通过累计直方图来作为特征。为什么不直接用像素呢？</span>


![mark](http://pacdb2bfr.bkt.clouddn.com/blog/image/180808/B3e3lHaKb5.png?imageslim)

这样，我们就能把字符识别出来了。<span style="color:red;">看看后面讲到神经网络的时候会不会对这个地方的处理进行补充。</span>

![mark](http://pacdb2bfr.bkt.clouddn.com/blog/image/180808/Lldc5I9j9L.png?imageslim)


<span style="color:red;">我还有个问题，识别出来的字符怎么知道那个在前面？难道是根据他们在图像中的像素位置？</span>



如何滤除夜间雨水反光？摄像头可以加个滤镜。加滤镜是最好的解决办法之一。
